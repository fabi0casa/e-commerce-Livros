# Generated by Selenium IDE
import pytest
import time
import json
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.support import expected_conditions
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities

#esse teste espera que o primeiro cliente da lista tenha 1 endereço de entrega e 2 carttões, e que nao tenha nenhum cupom

class TestVendas():
  def setup_method(self, method):
    self.driver = webdriver.Firefox()
    self.vars = {}
  
  def teardown_method(self, method):
    self.driver.quit()
  
  def acessarPagina(self):
    self.driver.get("http://localhost:8080/cliente/login")
    self.driver.set_window_size(1600, 866)
    time.sleep(5)
    self.driver.find_element(By.CSS_SELECTOR, "button").click()
    time.sleep(2)

  def adicionarAoCarrinho(self):
    self.driver.find_element(By.CSS_SELECTOR, ".product-card:nth-child(2) > img").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "quantidade").send_keys("2")
    time.sleep(1)
    self.driver.find_element(By.ID, "quantidade").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "quantidade").send_keys("3")
    time.sleep(1)
    self.driver.find_element(By.ID, "quantidade").click()
    time.sleep(1)
    element = self.driver.find_element(By.ID, "quantidade")
    actions = ActionChains(self.driver)
    actions.double_click(element).perform()
    time.sleep(1)
    self.driver.find_element(By.ID, "quantidade").send_keys("4")
    time.sleep(1)
    self.driver.find_element(By.ID, "quantidade").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".btn-carrinho").click()
    time.sleep(3)
    assert self.driver.switch_to.alert.text == "Livro adicionado ao carrinho com sucesso!"
    self.driver.switch_to.alert.accept()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".decrease").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".decrease").click()
    time.sleep(1)
    element = self.driver.find_element(By.CSS_SELECTOR, ".decrease")
    actions = ActionChains(self.driver)
    actions.double_click(element).perform()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".decrease").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".increase").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".remove").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".logo").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".product-card:nth-child(9) > img").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".btn-carrinho").click()
    time.sleep(2)
    assert self.driver.switch_to.alert.text == "Livro adicionado ao carrinho com sucesso!"
    self.driver.switch_to.alert.accept()
    time.sleep(1)
    self.driver.find_element(By.ID, "searchInput").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "searchInput").send_keys("guia")
    time.sleep(1)
    self.driver.find_element(By.ID, "searchInput").send_keys(Keys.ENTER)
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".product-card > img").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".btn-carrinho").click()
    time.sleep(2)
    assert self.driver.switch_to.alert.text == "Livro adicionado ao carrinho com sucesso!"
    self.driver.switch_to.alert.accept()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".cart-item:nth-child(1) .increase").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".cart-item:nth-child(2) .increase").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".cart-item:nth-child(2) .increase").click()
    time.sleep(1)

  def comprarLivro(self):
    self.driver.find_element(By.CSS_SELECTOR, ".checkout-btn").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "endereco").click()
    dropdown = self.driver.find_element(By.ID, "endereco")
    time.sleep(1)
    dropdown.find_element(By.XPATH, ".//option[contains(text(), 'Selecione')]/following-sibling::option[1]").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "option:nth-child(2)").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "cartao1").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-1").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-1").send_keys("130")
    time.sleep(1)
    self.driver.find_element(By.ID, "cartao2").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-2").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-2").send_keys("9.7")
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".checkout-btn").click()
    time.sleep(1)
    assert self.driver.switch_to.alert.text == "Informe um valor válido (mínimo R$ 10,00) para o cartão selecionado."
    time.sleep(1)
    self.driver.switch_to.alert.accept()
    time.sleep(1)
    assert self.driver.switch_to.alert.text == "A soma dos valores dos cartões deve ser exatamente R$ 139,70"
    time.sleep(1)
    self.driver.switch_to.alert.accept()
    time.sleep(1)
    self.driver.find_element(By.ID, "cartao2").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-1").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-1").clear()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-1").send_keys("139.7")
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".checkout-btn").click()
    time.sleep(3)
    self.driver.find_element(By.ID, "pedidoCodigoBold").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "pedidoCodigoBold").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "pedidoCodigoBold").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "#pedidoModal button").click()
    time.sleep(1)

  def verPedido(self):
    self.driver.find_element(By.CSS_SELECTOR, ".menu > button:nth-child(5)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".ver-pedido-btn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".sub-rows:nth-child(2) tr:nth-child(1) .reprovado").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".modal-tabela-content > .close").click()
    time.sleep(1)

  def aprovarPedidos(self):
    self.driver.get("http://localhost:8080/administrador/gerenciamento-vendas/gerenciarVendas")
    time.sleep(3)
    self.driver.find_element(By.CSS_SELECTOR, ".ver-pedido-btn").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "td:nth-child(6) > .aprovado").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".status-btn:nth-child(2)").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "td:nth-child(6) > .status-btn").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, "td:nth-child(6) > .status-btn").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".close").click()

  def solicitarTroca(self):
    self.driver.get("http://localhost:8080/cliente/conta")
    time.sleep(3)
    self.driver.find_element(By.CSS_SELECTOR, ".menu > button:nth-child(5)").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "pesquisar").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".ver-pedido-btn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "tr:nth-child(1) .troca").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "tr:nth-child(2) .troca").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".devolucao").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > .status-cell").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".modal-tabela-content > .close").click()
    time.sleep(1)

  def aprovarTroca(self):
    self.driver.get("http://localhost:8080/administrador/gerenciamento-vendas/gerenciarVendas")
    time.sleep(3)
    self.driver.find_element(By.ID, "pesquisar").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".ver-pedido-btn").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "tr:nth-child(2) > td:nth-child(4) > .troca").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "tr:nth-child(1) > td:nth-child(4) > .reprovado").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "td:nth-child(4) > .troca").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "td:nth-child(4) > .devolucao").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "label").click()
    time.sleep(2)
    self.driver.find_element(By.ID, "confirmarBtn").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(4)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(4)").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".close").click()

  def verificarCupons(self):
    self.driver.get("http://localhost:8080/cliente/conta")
    self.driver.find_element(By.ID, "accountText").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".info-buttons > button:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "#cupomModal .accordion:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "#cupomModal .accordion:nth-child(5)").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, "#cupomModal .close").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".menu > button:nth-child(5)").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, ".ver-pedido-btn").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(1) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".expandable-row:nth-child(3) > td:nth-child(3)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".modal-tabela-content > .close").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".logo").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".product-card:nth-child(4) > .product-info").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".btn-comprar").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "endereco").click()
    dropdown = self.driver.find_element(By.ID, "endereco")
    time.sleep(1)
    dropdown.find_element(By.XPATH, ".//option[contains(text(), 'Selecione')]/following-sibling::option[1]").click()
    self.driver.find_element(By.CSS_SELECTOR, "#endereco > option:nth-child(2)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".coupon-btn").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "cupomSelect").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "#couponModal button").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".coupon-btn").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, "#couponModal button").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "cartao1").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-1").click()
    time.sleep(1)
    self.driver.find_element(By.ID, "valor-cartao-1").send_keys("230.2")
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".checkout-btn").click()
    time.sleep(3)
    self.driver.find_element(By.CSS_SELECTOR, "#pedidoModal button").click()
    time.sleep(1.5)
    self.driver.find_element(By.CSS_SELECTOR, ".info-buttons > button:nth-child(3)").click()
    time.sleep(2)
    self.driver.find_element(By.CSS_SELECTOR, "#cupomModal .close").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".menu > button:nth-child(5)").click()
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".pedido-item:nth-child(1) .ver-pedido-btn").click()
    time.sleep(1)
    element = self.driver.find_element(By.CSS_SELECTOR, ".pedido-item:nth-child(1) .ver-pedido-btn")
    time.sleep(1)
    self.driver.find_element(By.CSS_SELECTOR, ".modal-tabela-content > .close").click()
    time.sleep(2)

  def main(self):
        self.acessarPagina()
        self.adicionarAoCarrinho()
        self.comprarLivro()
        self.verPedido()
        self.aprovarPedidos()
        self.solicitarTroca()
        self.aprovarTroca()
        self.verificarCupons()

# Para rodar os testes
if __name__ == "__main__":
    test = TestVendas()
    test.setup_method(None)
    try:
        test.main()
    finally:
        test.teardown_method(None)

